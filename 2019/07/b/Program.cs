using System;
using System.Collections.Generic;
using System.Linq;

namespace b
{
    class Program
    {
        static void Main(string[] args)
        {
            string program = "3,8,1001,8,10,8,105,1,0,0,21,46,67,88,101,126,207,288,369,450,99999,3,9,1001,9,5,9,1002,9,5,9,1001,9,5,9,102,3,9,9,101,2,9,9,4,9,99,3,9,102,4,9,9,101,5,9,9,102,5,9,9,101,3,9,9,4,9,99,3,9,1001,9,3,9,102,2,9,9,1001,9,5,9,102,4,9,9,4,9,99,3,9,102,3,9,9,1001,9,4,9,4,9,99,3,9,102,3,9,9,1001,9,3,9,1002,9,2,9,101,4,9,9,102,3,9,9,4,9,99,3,9,101,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,1002,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,101,1,9,9,4,9,99,3,9,101,1,9,9,4,9,3,9,1001,9,2,9,4,9,3,9,1001,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,2,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,1,9,4,9,3,9,1002,9,2,9,4,9,99,3,9,101,1,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,102,2,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,1,9,4,9,3,9,1001,9,2,9,4,9,3,9,101,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,1001,9,1,9,4,9,99,3,9,101,2,9,9,4,9,3,9,101,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,2,9,9,4,9,3,9,1001,9,1,9,4,9,3,9,101,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,1,9,9,4,9,3,9,101,1,9,9,4,9,3,9,101,1,9,9,4,9,99,3,9,101,1,9,9,4,9,3,9,102,2,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,101,1,9,9,4,9,3,9,1002,9,2,9,4,9,3,9,1002,9,2,9,4,9,3,9,1001,9,2,9,4,9,3,9,1002,9,2,9,4,9,3,9,1001,9,2,9,4,9,3,9,102,2,9,9,4,9,99";

            var combinations = new List<int[]>();
            for (int ia = 5; ia < 10; ia++)
                for (int ib = 5; ib < 10; ib++)
                    for (int ic = 5; ic < 10; ic++)
                        for (int id = 5; id < 10; id++)
                            for (int ie = 5; ie < 10; ie++)
                            {
                                var combination = new[] { ia, ib, ic, id, ie };
                                if (combination.Distinct().Count() == 5)
                                {
                                    combinations.Add(combination);
                                }
                            }

            var instructions = program.Split(',').Select(int.Parse).ToArray();

            var max = 0;
            foreach (var phases in combinations)
            {
                var computers = Enumerable.Range(0, 5)
                    .Select(x => new Computer(instructions, x == 0 ? new[] { phases[x], 0 } : new[] { phases[x] }))
                    .ToArray();

                for (int i = 0; i < int.MaxValue; i++)
                {
                    i %= 5;
                    var done = computers[i].Run();

                    if (done && i == 4)
                    {
                        max = Math.Max(max, computers[i].Outputs.Dequeue());
                        break;
                    }

                    while (computers[i].Outputs.Count > 0)
                    {
                        computers[(i + 1) % 5].Inputs.Enqueue(computers[i].Outputs.Dequeue());
                    }
                }
            }

            System.Console.WriteLine(max);
        }
    }
}
